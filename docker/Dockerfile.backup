FROM ubuntu:22.04

# Install MariaDB client, Google Cloud SDK and utilities
RUN apt-get update && apt-get install -y \
    curl \
    python3 \
    python3-pip \
    cron \
    tar \
    gzip \
    mariadb-client \
    && rm -rf /var/lib/apt/lists/* \
    && curl https://sdk.cloud.google.com | bash -s -- --disable-prompts --install-dir=/opt \
    && /opt/google-cloud-sdk/bin/gcloud components install gsutil --quiet

# Add gcloud to PATH
ENV PATH="/opt/google-cloud-sdk/bin:${PATH}"

COPY backup-entrypoint.sh /backup-entrypoint.sh
RUN chmod +x /backup-entrypoint.sh

ENTRYPOINT ["/backup-entrypoint.sh"]
