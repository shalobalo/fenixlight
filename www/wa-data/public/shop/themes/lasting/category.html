<section>
<div class="second-page-container">
<div class="container">
<div class="row">

    {include file="sidebar.html"}




<div class="col-md-9">
    {include file="breadcrumbs.html"}

    <div class="header-for-light">
        <h1 class="wow fadeInRight animated" data-wow-duration="1s">{if !empty($category.params) && isset($category.params.h1)}{$category.params.h1}{else}{$category.name}{/if}</h1>

    </div>
    <div class="block-products-modes color-scheme-2">
        <div class="row">
            <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                <div class="product-view-mode">
                    <a title="Витрина" href="#" class="list_link{if waRequest::get(view) eq 'grid' or !waRequest::get(view)} active{/if}" rel="grid"><i class="fa fa-th-large"></i></a>
                    <a title="Список" href="#" class="list_link{if waRequest::get(view) eq 'table'} active{/if}" rel="table"><i class="fa fa-th-list"></i></a>
                </div>
                <script type="text/javascript">
                    $("a.list_link").click(function () {
                        var url = location.href;
                        if (url.indexOf('?') == -1) {
                            url += '?';
                        } else {
                            url += '&';
                        }
                        if(url.indexOf('view') == -1) {
                            location.href = url + 'view=' + $(this).attr('rel');
                        }
                        else {
                            if(url.indexOf('&view') == -1) {
                                var newURL = url.split('?view', 1)[0];
                                newURL += '?';
                                newAfterURL = url.split('?view')[1];
                                newAfterURL = newAfterURL.split('&');
                                var nameAfterURL = '';
                                for (i = 1, l = newAfterURL.length; i < l; i += 1) {
                                    if( newAfterURL[i] != '') { nameAfterURL += '&' + newAfterURL[i]; }
                                }
                            } else if(url.indexOf('?view') == -1) {
                                var newURL = url.split('&view', 1)[0];
                                newURL += '&';
                                newAfterURL = url.split('&view')[1];
                                newAfterURL = newAfterURL.split('&');
                                var nameAfterURL = '';
                                for (i = 1, l = newAfterURL.length; i < l; i += 1) {
                                    if( newAfterURL[i] != '') { nameAfterURL += '&' + newAfterURL[i]; }
                                }
                            }
                            location.href = newURL + 'view=' + $(this).attr('rel') + nameAfterURL;
                        }
                        return false;
                    });
                </script>
            </div>
            <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9">
                <div class="row">
                    <div class="col-md-3 col-md-offset-1">
                        <label class="pull-right">Сортировать:</label>
                    </div>
                    <div class="col-md-6">

                        {$sort_fields = ['rating' => '[`Customer rating`]', 'total_sales' => '[`Bestsellers`]', 'price' => '[`Price`]', 'name' => '[`Name`]', 'create_datetime'=>'[`Date added`]', 'stock' => '[`In stock`]']}
                        {if !isset($active_sort)}
                            {$active_sort = $wa->get('sort', 'create_datetime')}
                        {/if}

                        <select id="sorting" name="sort-type" class="form-control">

                            {if !empty($category) && !$category.sort_products}
                            <option {if !$active_sort} selected{/if} value="{$wa->currentUrl(0, 1)}">[`New & Popular`]</option>
                            {/if}
                            {foreach $sort_fields as $sort => $name}
                            <option {if $active_sort == $sort} selected{/if} value="{$sort}">{$name}</option>
                            {if $wa->get('sort') == $sort}{$wa->title( $wa->title()|cat:' — '|cat:$name)}{/if}
                            {/foreach}

                        </select>
                    </div>
                        <script type="text/javascript">
                            $("#sorting").change(function () {
                                var url = location.href;
                                if (url.indexOf('?') == -1) {
                                    url += '?';
                                } else {
                                    url += '&';
                                }

                                if(url.indexOf('sort') == -1) {
                                    location.href = url + 'sort=' + $(this).val();
                                }
                                else {
                                    if(url.indexOf('&sort') == -1) {
                                        var newURL = url.split('?sort', 1)[0];
                                        newURL += '?';
                                        newAfterURL = url.split('?sort')[1];
                                        newAfterURL = newAfterURL.split('&');
                                        var nameAfterURL = '';
                                        for (i = 1, l = newAfterURL.length; i < l; i += 1) {
                                            if( newAfterURL[i] != '') { nameAfterURL += '&' + newAfterURL[i]; }
                                        }
                                    } else if(url.indexOf('?sort') == -1) {
                                        var newURL = url.split('&sort', 1)[0];
                                        newURL += '&';
                                        newAfterURL = url.split('&sort')[1];
                                        newAfterURL = newAfterURL.split('&');
                                        var nameAfterURL = '';
                                        for (i = 1, l = newAfterURL.length; i < l; i += 1) {
                                            if( newAfterURL[i] != '') { nameAfterURL += '&' + newAfterURL[i]; }
                                        }
                                    }
                                    location.href = newURL + 'sort=' + $(this).val() + nameAfterURL;
                                }

                            });
                        </script>


                    <!--div class="col-md-3">
                        <select name="products-per-page" class="form-control">
                            <option value="10" selected="selected">10</option>
                            <option value="20">20</option>
                            <option value="30">30</option>
                            <option value="100">100</option>
                            <option value="all">All</option>
                        </select>
                    </div-->
                </div>
            </div>
        </div>
    </div>
        {if !$products}
            [`No products matched your filtering criteria.`]
        {else if waRequest::get(view) eq 'table'}
            {foreach $products as $p}
                {include file='product_list.html' p=$p}
            {/foreach}
        {else}
            <div class="row">
                {foreach $products as $p}
                    <div class="col-xs-12 col-sm-6 col-md-4 text-center mb-12 product-grid">
                    {include file='product_grid.html' p=$p}
                    </div>
                {/foreach}
            </div>
        {/if}

        {if isset($pages_count) && $pages_count > 1}
        <div class="block-pagination">
            {wa_pagination total=$pages_count attrs=['class' => "pagination"]}
        </div><!-- .pagination -->
        {/if}

        {if $category.description && !waRequest::get(page)}
        <div id="category_description">{$category.description}</div>
        {/if}

</div>

</div>
</div>
</div>

</section>